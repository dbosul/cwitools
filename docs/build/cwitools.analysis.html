
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>cwitools package &#8212; CWITools v0.5 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="module-cwitools">
<span id="cwitools-analysis-package"></span><h1>cwitools package<a class="headerlink" href="#module-cwitools" title="Permalink to this headline">¶</a></h1>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-cwitools.imaging">
<span id="cwitools-analysis-imaging-module"></span><h2>cwitools.imaging module<a class="headerlink" href="#module-cwitools.imaging" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="cwitools.imaging.get_cutout">
<code class="sig-prename descclassname">cwitools.imaging.</code><code class="sig-name descname">get_cutout</code><span class="sig-paren">(</span><em class="sig-param">fits_in</em>, <em class="sig-param">ra</em>, <em class="sig-param">dec</em>, <em class="sig-param">box_size</em>, <em class="sig-param">z=0</em>, <em class="sig-param">fill=0</em><span class="sig-paren">)</span><a class="headerlink" href="#cwitools.imaging.get_cutout" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract a box (in pkpc) around a central position from a 2D or 3D FITS.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fits_in</strong> (<em>astropy.io.fits.HDUList</em>) – The input FITS file.</p></li>
<li><p><strong>ra</strong> (<em>float</em>) – Right-ascension of box center, in decimal degrees.</p></li>
<li><p><strong>dec</strong> (<em>float</em>) – Declination of box center, in decimal degrees.</p></li>
<li><p><strong>z</strong> (<em>float</em>) – Cosmological redshift of the source.</p></li>
<li><p><strong>box_size</strong> (<em>float</em>) – The size of the box, in proper kiloparsec.</p></li>
<li><p><strong>fill</strong> (<em>string</em>) – The fill value for box regions outside the image bounds.
Default: 0.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The FITS with cutout data and header.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>astropy.io.fits.HDUList</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>To extract a 2D region of size 250x250 pkpc^2 around the QSO from a
pseudo-Narrowband image:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">cwitools</span> <span class="k">import</span> <span class="n">imaging</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">cwitools</span> <span class="k">import</span> <span class="n">parameters</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.io</span> <span class="k">import</span> <span class="n">fits</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qso_nb_fits</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;QSO_123.fits&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target_params</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">load_params</span><span class="p">(</span><span class="s2">&quot;QSO_123.param&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qso_cutout</span> <span class="o">=</span> <span class="n">imaging</span><span class="o">.</span><span class="n">get_cutout</span><span class="p">(</span><span class="n">qso_nb_fits</span><span class="p">,</span> <span class="n">target_params</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
</pre></div>
</div>
<p>This method assumes a 1:1 aspect ratio for the spatial axes of the
input.</p>
</dd></dl>

<dl class="function">
<dt id="cwitools.imaging.get_pseudo_nb">
<code class="sig-prename descclassname">cwitools.imaging.</code><code class="sig-name descname">get_pseudo_nb</code><span class="sig-paren">(</span><em class="sig-param">fits</em>, <em class="sig-param">wav_center</em>, <em class="sig-param">wav_width</em>, <em class="sig-param">pos=None</em>, <em class="sig-param">cwing=50</em>, <em class="sig-param">fit_r=2</em>, <em class="sig-param">sub_r=None</em>, <em class="sig-param">smooth=None</em>, <em class="sig-param">smoothtype='box'</em>, <em class="sig-param">mask=[]</em>, <em class="sig-param">var=[]</em>, <em class="sig-param">medsub=True</em><span class="sig-paren">)</span><a class="headerlink" href="#cwitools.imaging.get_pseudo_nb" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a pseudo-Narrow-Band (pNB) image from a data cube.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fits</strong> (<em>astropy.io.fits.HDUList</em>) – The input FITS file.</p></li>
<li><p><strong>wav_center</strong> (<em>float</em>) – The central wavelength of the narrow-band in Angstrom.</p></li>
<li><p><strong>wav_width</strong> (<em>float</em>) – The width of the narrow-band image in Angstrom.</p></li>
<li><p><strong>pos</strong> (<em>float tuple</em>) – The location the continuum source in x,y to subtract.
Leave empty to skip white-light subtraction.</p></li>
<li><p><strong>fit_r</strong> (<em>float</em>) – The radius around the source to use for scaling the PSF.</p></li>
<li><p><strong>sub_r</strong> (<em>float</em>) – The radius around the soruce to use when subtracting.</p></li>
<li><p><strong>smooth</strong> (<em>float</em>) – Size of smoothing kernel to use prior to subtraction.</p></li>
<li><p><strong>smoothtype</strong> (<em>string</em>) – Type of smoothing kernel to use:
‘box’: 2D Boxcar kernel (size=width)
‘gaussian’: 2D Gaussian Kernel (size=full-width at half-max)</p></li>
<li><p><strong>var</strong> (<em>NumPy.ndarray</em>) – Variance cube associated with input cube, required
to output associated variance images.</p></li>
<li><p><strong>medsub</strong> (<em>bool</em>) – Set to TRUE to median subtract WL image and NB (happens
before scaling of WL image, if performing subtraction.)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The pseudo-NB image (WL-subtracted if requested.)
numpy.ndarray: The white-light (WL) image.
numpy.ndarray: (If var given as input) The variance on the pNB image.
numpy.ndarray: (If var given as input) The variance on the WL image</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Note that this algorithm assumes input a cube with units of
erg/s/cm2/Angstrom, and header wavelength units of Angstrom.</p>
<p>To obtain a simple pseudo-Narrowband (and white-light image) with no
subtraction or variance estimation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">cwitools</span> <span class="k">import</span> <span class="n">imaging</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.io</span> <span class="k">import</span> <span class="n">fits</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">myfits</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;cube.fits&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pNB</span><span class="p">,</span> <span class="n">WL</span> <span class="o">=</span> <span class="n">imaging</span><span class="o">.</span><span class="n">get_pseudo_nb</span><span class="p">(</span><span class="n">myfits</span><span class="p">,</span> <span class="mi">4500</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
<p>If there is a QSO in the image at (x, y) = (40, 50) - then we can
obtain the continuum subtracted version with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pNB_sub</span><span class="p">,</span> <span class="n">WL</span> <span class="o">=</span> <span class="n">imaging</span><span class="o">.</span><span class="n">get_pseudo_nb</span><span class="p">(</span><span class="n">myfits</span><span class="p">,</span> <span class="mi">4500</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
</pre></div>
</div>
<p>Finally, if we want variance estimates on the output, we must provide
a variance cube:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">myvar</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s2">&quot;varcube.fits&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">imaging</span><span class="o">.</span><span class="n">get_pseudo_nb</span><span class="p">(</span><span class="n">myfits</span><span class="p">,</span> <span class="mi">4500</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">var</span><span class="o">=</span><span class="n">myvar</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">NB</span><span class="p">,</span> <span class="n">WL</span><span class="p">,</span> <span class="n">NB_var</span><span class="p">,</span> <span class="n">WL_var</span> <span class="o">=</span> <span class="n">r</span> <span class="o">//</span><span class="n">Unpack</span> <span class="n">the</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">order</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="cwitools.imaging.get_source_mask">
<code class="sig-prename descclassname">cwitools.imaging.</code><code class="sig-name descname">get_source_mask</code><span class="sig-paren">(</span><em class="sig-param">image</em>, <em class="sig-param">header</em>, <em class="sig-param">reg</em>, <em class="sig-param">src_box=3</em>, <em class="sig-param">model=False</em>, <em class="sig-param">mask_width=3</em><span class="sig-paren">)</span><a class="headerlink" href="#cwitools.imaging.get_source_mask" title="Permalink to this definition">¶</a></dt>
<dd><p>Get fitted mask of sources based on a DS9 region file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<em>NumPy.ndarray</em>) – The input image data.</p></li>
<li><p><strong>header</strong> (<em>Astropy Header</em>) – The header associated with the image</p></li>
<li><p><strong>reg</strong> (<em>string</em>) – The path to the DS9 region file</p></li>
<li><p><strong>src_box</strong> (<em>int</em>) – The box size to extract/use for fitting each source.</p></li>
<li><p><strong>model</strong> (<em>bool</em>) – Set to TRUE to return the both the mask and model</p></li>
<li><p><strong>mask_width</strong> (<em>float</em>) – The width of each mask, in standard deviations.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A mask with source regions labelled sequentially.
numpy.ndarray: A model of the source flux.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>To get a mask representing the sources in a narrowband image (“NB.fits”)
based on a DS9 region file (“mysources.reg”):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">cwitools</span> <span class="k">import</span> <span class="n">imaging</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.io</span> <span class="k">import</span> <span class="n">fits</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nb_image</span><span class="p">,</span> <span class="n">hdr</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;NB.fits&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reg</span> <span class="o">=</span> <span class="s2">&quot;mysources.reg&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">source_mask</span> <span class="o">=</span> <span class="n">imaging</span><span class="o">.</span><span class="n">get_source_mask</span><span class="p">(</span><span class="n">nb_image</span><span class="p">,</span> <span class="n">hdr</span><span class="p">,</span> <span class="n">reg</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="cwitools.imaging.slice_fix">
<code class="sig-prename descclassname">cwitools.imaging.</code><code class="sig-name descname">slice_fix</code><span class="sig-paren">(</span><em class="sig-param">image</em>, <em class="sig-param">mask=None</em>, <em class="sig-param">axis=0</em>, <em class="sig-param">scval=3</em><span class="sig-paren">)</span><a class="headerlink" href="#cwitools.imaging.slice_fix" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform slice-by-slice median correction in an image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<em>NumPy.ndarray</em>) – The input image data.</p></li>
<li><p><strong>mask</strong> (<em>NumPy.ndarray</em>) – A corresponding mask, used to exclude pixels from
the median calculation ((&gt;=1)=ignore, 0=use)</p></li>
<li><p><strong>axis</strong> (<em>int</em>) – The axis along which to subtract.</p></li>
<li><p><strong>scval</strong> (<em>float</em>) – The sigma-clipping threshold applied before median calculation.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The slice-by-slice median subtracted image.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cwitools.imaging.smooth_nd">
<code class="sig-prename descclassname">cwitools.imaging.</code><code class="sig-name descname">smooth_nd</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">scale</em>, <em class="sig-param">axes=None</em>, <em class="sig-param">ktype='gaussian'</em>, <em class="sig-param">var=False</em><span class="sig-paren">)</span><a class="headerlink" href="#cwitools.imaging.smooth_nd" title="Permalink to this definition">¶</a></dt>
<dd><p>Smooth along all/any axes of a data cube with a box or gaussian kernel.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cube</strong> (<em>numpy.ndarray</em>) – The input datacube.</p></li>
<li><p><strong>scale</strong> (<em>float</em>) – The smoothing scale.
For a gaussian kernel, this is full-width at half-maximum (FWHM)
For a box kernel, this is the width of the box.</p></li>
<li><p><strong>axes</strong> (<em>int tuple</em>) – The axes to smooth along. Default is all input axes.</p></li>
<li><p><strong>ktype</strong> (<em>str</em>) – The kernel type (‘gaussian’ or ‘box’)</p></li>
<li><p><strong>var</strong> (<em>bool</em>) – Set to TRUE when smoothing variance data.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The smoothed data cube.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-cwitools.kinematics">
<span id="cwitools-analysis-kinematics-module"></span><h2>cwitools.kinematics module<a class="headerlink" href="#module-cwitools.kinematics" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="cwitools.kinematics.basic_moments">
<code class="sig-prename descclassname">cwitools.kinematics.</code><code class="sig-name descname">basic_moments</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">y</em>, <em class="sig-param">y_var=[]</em>, <em class="sig-param">pos_thresh=False</em>, <em class="sig-param">m1_init=None</em>, <em class="sig-param">window=30</em>, <em class="sig-param">get_err=True</em><span class="sig-paren">)</span><a class="headerlink" href="#cwitools.kinematics.basic_moments" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate first and second moment.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>np.array</em>) – Input coordinate values (e.g. wavelength).</p></li>
<li><p><strong>y</strong> (<em>np.array</em>) – Input weights (i.e. intensity)</p></li>
<li><p><strong>pos_thresh</strong> (<em>bool</em>) – Set to TRUE to exclude negative weights.</p></li>
<li><p><strong>m1_init</strong> (<em>float</em>) – Initial guess for the first moment value</p></li>
<li><p><strong>window</strong> (<em>float</em>) – Size of window, centered on m1_init, to use</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The first moment in x.
float: The second moment in x.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cwitools.kinematics.closing_window_moments">
<code class="sig-prename descclassname">cwitools.kinematics.</code><code class="sig-name descname">closing_window_moments</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">y</em>, <em class="sig-param">m1_init=None</em>, <em class="sig-param">window_max=25</em>, <em class="sig-param">window_min=15</em>, <em class="sig-param">window_step_size=1</em>, <em class="sig-param">y_var=[]</em>, <em class="sig-param">get_err=True</em><span class="sig-paren">)</span><a class="headerlink" href="#cwitools.kinematics.closing_window_moments" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate first and second moments using the ‘closing-window method’ (O’Sullivan et al. 2020).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>np.array</em>) – Input coordinate values (e.g. wavelength).</p></li>
<li><p><strong>y</strong> (<em>np.array</em>) – Input weights (i.e. intensity)</p></li>
<li><p><strong>m1_init</strong> (<em>float</em>) – Initial guess for first moment, used to center window.
If none given, center value of x will be used.</p></li>
<li><p><strong>window_max</strong> (<em>float</em>) – Starting window size for calculation (in same unit as x)</p></li>
<li><p><strong>window_min</strong> (<em>float</em>) – Minimum window size for calculation. (same units as x)</p></li>
<li><p><strong>window_step_size</strong> (<em>float</em>) – Decrease in window size for each step (same units as x).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The first moment in x.
float: Error on the final first moment calculation (if get_err is True)
float: The second moment in x
float: Error on the final second moment calculation (if get_err is True)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cwitools.kinematics.first_moment">
<code class="sig-prename descclassname">cwitools.kinematics.</code><code class="sig-name descname">first_moment</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">y</em>, <em class="sig-param">y_var=[]</em>, <em class="sig-param">get_err=False</em><span class="sig-paren">)</span><a class="headerlink" href="#cwitools.kinematics.first_moment" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate first moment.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>np.array</em>) – Input coordinate values (e.g. wavelength).</p></li>
<li><p><strong>y</strong> (<em>np.array</em>) – Input weights (i.e. intensity)</p></li>
<li><p><strong>y_var</strong> (<em>np.array</em>) – Variance on y. Taken as var(y) if not provided.</p></li>
<li><p><strong>get_err</strong> (<em>bool</em>) – Set to TRUE to return (moment, error) tuple</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The first moment in x.
float: The error on the first moment (if get_err == True)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cwitools.kinematics.first_moment_err">
<code class="sig-prename descclassname">cwitools.kinematics.</code><code class="sig-name descname">first_moment_err</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">y</em>, <em class="sig-param">y_var=[]</em><span class="sig-paren">)</span><a class="headerlink" href="#cwitools.kinematics.first_moment_err" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate propagated error on the first moment.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>np.array</em>) – Input coordinate values (e.g. wavelength).</p></li>
<li><p><strong>y</strong> (<em>np.array</em>) – Input weights (i.e. intensity)</p></li>
<li><p><strong>y_var</strong> (<em>np.array</em>) – Variance on y. Taken as var(y) if not provided.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The error on the first moment</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cwitools.kinematics.second_moment">
<code class="sig-prename descclassname">cwitools.kinematics.</code><code class="sig-name descname">second_moment</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">y</em>, <em class="sig-param">m1=None</em>, <em class="sig-param">y_var=[]</em>, <em class="sig-param">get_err=False</em><span class="sig-paren">)</span><a class="headerlink" href="#cwitools.kinematics.second_moment" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate first moment.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>np.array</em>) – Input coordinate values (e.g. wavelength).</p></li>
<li><p><strong>y</strong> (<em>np.array</em>) – Input weights (i.e. intensity)</p></li>
<li><p><strong>m1</strong> (<em>float</em>) – The first moment. Calculated if not provided.</p></li>
<li><p><strong>y_var</strong> (<em>np.array</em>) – Variance on y. Taken as var(y) if not provided.</p></li>
<li><p><strong>get_err</strong> (<em>bool</em>) – Set to TRUE to return (moment, error), tuple</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The second moment in x.
float: The error on the second moment (if get_err == True)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cwitools.kinematics.second_moment_err">
<code class="sig-prename descclassname">cwitools.kinematics.</code><code class="sig-name descname">second_moment_err</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">y</em>, <em class="sig-param">m1=None</em>, <em class="sig-param">y_var=[]</em><span class="sig-paren">)</span><a class="headerlink" href="#cwitools.kinematics.second_moment_err" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate propagated error on the second moment.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>np.array</em>) – Input coordinate values (e.g. wavelength).</p></li>
<li><p><strong>y</strong> (<em>np.array</em>) – Input weights (i.e. intensity)</p></li>
<li><p><strong>m1</strong> (<em>float</em>) – The value of the first moment</p></li>
<li><p><strong>y_var</strong> (<em>np.array</em>) – Variance on y. Taken as var(y) if not provided.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The error on the second moment</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-cwitools.modeling">
<span id="cwitools-analysis-modeling-module"></span><h2>cwitools.modeling module<a class="headerlink" href="#module-cwitools.modeling" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="cwitools.modeling.aic">
<code class="sig-prename descclassname">cwitools.modeling.</code><code class="sig-name descname">aic</code><span class="sig-paren">(</span><em class="sig-param">model</em>, <em class="sig-param">data</em>, <em class="sig-param">k</em><span class="sig-paren">)</span><a class="headerlink" href="#cwitools.modeling.aic" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the Akaike Information Criterion for a model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> (<em>NumPy.ndarray</em>) – The model data being evaluated</p></li>
<li><p><strong>data</strong> (<em>NumPy.ndarray</em>) – The data being modeled</p></li>
<li><p><strong>k</strong> (<em>int</em>) – The number of parameters in the model</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The Akaike Information Criterion</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>aic (float)</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cwitools.modeling.bic">
<code class="sig-prename descclassname">cwitools.modeling.</code><code class="sig-name descname">bic</code><span class="sig-paren">(</span><em class="sig-param">model</em>, <em class="sig-param">data</em>, <em class="sig-param">k</em><span class="sig-paren">)</span><a class="headerlink" href="#cwitools.modeling.bic" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the Bayesian Information Criterion for a model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> (<em>NumPy.ndarray</em>) – The model data being evaluated</p></li>
<li><p><strong>data</strong> (<em>NumPy.ndarray</em>) – The data being modeled</p></li>
<li><p><strong>k</strong> (<em>int</em>) – The number of parameters in the model</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The Bayesian Information Criterion</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>bic (float)</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cwitools.modeling.bic_weights">
<code class="sig-prename descclassname">cwitools.modeling.</code><code class="sig-name descname">bic_weights</code><span class="sig-paren">(</span><em class="sig-param">bic_list</em><span class="sig-paren">)</span><a class="headerlink" href="#cwitools.modeling.bic_weights" title="Permalink to this definition">¶</a></dt>
<dd><p>Get weights representing relative likelihood of models based on BICs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>bic_list</strong> (<em>array-like</em>) – Array of BIC values for models.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Array of relative likelihoods for models.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>weights (Numpy.array)</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cwitools.modeling.fit_de">
<code class="sig-prename descclassname">cwitools.modeling.</code><code class="sig-name descname">fit_de</code><span class="sig-paren">(</span><em class="sig-param">model_func</em>, <em class="sig-param">model_bounds</em>, <em class="sig-param">xdata</em>, <em class="sig-param">ydata</em><span class="sig-paren">)</span><a class="headerlink" href="#cwitools.modeling.fit_de" title="Permalink to this definition">¶</a></dt>
<dd><p>Generic wrapper for fitting a model using SciPy’s differential evolution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model_func</strong> (<em>callable</em>) – The model function, of the form
f(params, x) - where params is a list of model parameters.</p></li>
<li><p><strong>model_bounds</strong> (<em>list</em>) – List of tuples representing (lower, upper) bounds
on the model parameters.</p></li>
<li><p><strong>xdata</strong> (<em>numpy.array</em>) – Input x data (e.g. wavelength)</p></li>
<li><p><strong>ydata</strong> (<em>numpy.array</em>) – Input y data (e.g. flux)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The result of the fit.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>scipy.optimize.OptimizeResult</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cwitools.modeling.fwhm2sigma">
<code class="sig-prename descclassname">cwitools.modeling.</code><code class="sig-name descname">fwhm2sigma</code><span class="sig-paren">(</span><em class="sig-param">fwhm</em><span class="sig-paren">)</span><a class="headerlink" href="#cwitools.modeling.fwhm2sigma" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert Gaussian FWHM (Full-Width at Half Maximum) to standard deviation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>fwhm</strong> (<em>float</em>) – Full-Width at Half Maximum of a Gaussian function.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The standard deviation of the equivalent Gaussian.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cwitools.modeling.gauss1d">
<code class="sig-prename descclassname">cwitools.modeling.</code><code class="sig-name descname">gauss1d</code><span class="sig-paren">(</span><em class="sig-param">params</em>, <em class="sig-param">x</em><span class="sig-paren">)</span><a class="headerlink" href="#cwitools.modeling.gauss1d" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple wrapper for a one-dimensional Gaussian.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>params</strong> (<em>list</em>) – 1D Gaussian parameters (amplitude, mean, std_dev)</p></li>
<li><p><strong>x</strong> (<em>numpy.array</em>) – The input  on which to evaluate the model</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The Gaussian model output</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy.array</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cwitools.modeling.moffat1d">
<code class="sig-prename descclassname">cwitools.modeling.</code><code class="sig-name descname">moffat1d</code><span class="sig-paren">(</span><em class="sig-param">params</em>, <em class="sig-param">x</em><span class="sig-paren">)</span><a class="headerlink" href="#cwitools.modeling.moffat1d" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple wrapper for a one-dimensional Moffat profile.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>params</strong> (<em>list</em>) – 1D Moffat parameters (amplitude, mean, alpha, gamma)</p></li>
<li><p><strong>x</strong> (<em>numpy.array</em>) – The input  on which to evaluate the model</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The Moffat model output</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy.array</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cwitools.modeling.rss">
<code class="sig-prename descclassname">cwitools.modeling.</code><code class="sig-name descname">rss</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">model</em><span class="sig-paren">)</span><a class="headerlink" href="#cwitools.modeling.rss" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the residual sum of squares for a model and data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>NumPy.ndarray</em>) – Observed data.</p></li>
<li><p><strong>model</strong> (<em>NumPy.ndarray</em>) – Modeled data.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Sum of square residuals for the input data and model.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>rss (float)</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cwitools.modeling.rss_func">
<code class="sig-prename descclassname">cwitools.modeling.</code><code class="sig-name descname">rss_func</code><span class="sig-paren">(</span><em class="sig-param">model_params</em>, <em class="sig-param">x</em>, <em class="sig-param">y</em>, <em class="sig-param">model_func</em><span class="sig-paren">)</span><a class="headerlink" href="#cwitools.modeling.rss_func" title="Permalink to this definition">¶</a></dt>
<dd><p>Generic wrapper to get residual sum of squares for a model/data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model_params</strong> (<em>list</em>) – The parameters of the model</p></li>
<li><p><strong>x</strong> (<em>numpy.array</em>) – The input x axis data</p></li>
<li><p><strong>y</strong> (<em>numpy.array</em>) – The input y axis data</p></li>
<li><p><strong>model_func</strong> (<em>callable</em>) – The model function</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The residual sum of squares</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cwitools.modeling.sigma2fwhm">
<code class="sig-prename descclassname">cwitools.modeling.</code><code class="sig-name descname">sigma2fwhm</code><span class="sig-paren">(</span><em class="sig-param">sigma</em><span class="sig-paren">)</span><a class="headerlink" href="#cwitools.modeling.sigma2fwhm" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert standard deviation to FWHM (Full-Width at Half Maximum).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>sigma</strong> (<em>float</em>) – Standard deviation of a Gaussian function.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The full-width at half-maximum of the same Gaussian function</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-cwitools.subtraction">
<span id="cwitools-analysis-subtraction-module"></span><h2>cwitools.subtraction module<a class="headerlink" href="#module-cwitools.subtraction" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="cwitools.subtraction.bg_sub">
<code class="sig-prename descclassname">cwitools.subtraction.</code><code class="sig-name descname">bg_sub</code><span class="sig-paren">(</span><em class="sig-param">inputfits, method='polyfit', poly_k=1, median_window=31, zmasks=[(0, 0)], zunit='A'</em><span class="sig-paren">)</span><a class="headerlink" href="#cwitools.subtraction.bg_sub" title="Permalink to this definition">¶</a></dt>
<dd><p>Subtracts extended continuum emission / scattered light from a cube</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cubePath</strong> (<em>str</em>) – Path to the data cube to be subtracted.</p></li>
<li><p><strong>method</strong> (<em>str</em>) – Which method to use to model background
‘polyfit’: Fits polynomial to the spectrum in each spaxel (default.)
‘median’: Subtract the spatial median of each wavelength layer.
‘medfilt’: Model spectrum in each spaxel by median filtering it.
‘noiseFit’: Model noise in each z-layer and subtract mean.</p></li>
<li><p><strong>poly_k</strong> (<em>int</em>) – The degree of polynomial to use for background modeling.</p></li>
<li><p><strong>median_window</strong> (<em>int</em>) – The filter window size to use if median filtering.</p></li>
<li><p><strong>zmask</strong> (<em>int tuple</em>) – Wavelength region to mask, given as tuple of indices.</p></li>
<li><p><strong>zunit</strong> (<em>str</em>) – If using zmask, indices are given in these units.
‘A’: Angstrom (default)
‘px’: pixels</p></li>
<li><p><strong>saveModel</strong> (<em>bool</em>) – Set to TRUE to save background model cube.</p></li>
<li><p><strong>fileExt</strong> (<em>str</em>) – File extension to use for output (Default: .bs.fits)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Background-subtracted cube
NumPy.ndarray: Cube containing background model which was subtracted.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>NumPy.ndarray</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>To model the background with 1D polynomials for each spaxel’s spectrum,
using a quadratic polynomial (k=2):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">cwitools</span> <span class="k">import</span> <span class="n">bg_subtract</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.io</span> <span class="k">import</span> <span class="n">fits</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">myfits</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;mydata.fits&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bgsub_cube</span><span class="p">,</span> <span class="n">bgmodel_cube</span> <span class="o">=</span> <span class="n">bg_subtract</span><span class="p">(</span><span class="n">myfits</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;polfit&#39;</span><span class="p">,</span> <span class="n">poly_k</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="cwitools.subtraction.psf_sub_1d">
<code class="sig-prename descclassname">cwitools.subtraction.</code><code class="sig-name descname">psf_sub_1d</code><span class="sig-paren">(</span><em class="sig-param">fits_in</em>, <em class="sig-param">pos</em>, <em class="sig-param">fit_rad=2</em>, <em class="sig-param">sub_rad=15</em>, <em class="sig-param">slice_rad=4</em>, <em class="sig-param">wl_window=150</em>, <em class="sig-param">wmasks=[]</em>, <em class="sig-param">slice_axis=2</em><span class="sig-paren">)</span><a class="headerlink" href="#cwitools.subtraction.psf_sub_1d" title="Permalink to this definition">¶</a></dt>
<dd><p>Models and subtracts a point-source on a slice-by-slice basis.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fits_in</strong> (<em>astrop FITS object</em>) – Input data cube/FITS.</p></li>
<li><p><strong>pos</strong> (<em>float tuple</em>) – (x,y) position of the source to subtract.</p></li>
<li><p><strong>fit_rad</strong> (<em>float</em>) – Inner radius, in arcsec, to use for fitting PSF within a slice.</p></li>
<li><p><strong>sub_rad</strong> (<em>float</em>) – Outer radius, in arcsec, over which to subtract PSF within a slice.</p></li>
<li><p><strong>slice_rad</strong> (<em>int</em>) – Number of slices to subtract over, as distance from the
slice indicated by the <a href="#id1"><span class="problematic" id="id2">`</span></a>pos’ argument.</p></li>
<li><p><strong>wl_window</strong> (<em>float</em>) – Size of white-light window (in Angstrom) to use.
This is the window used to form a white-light image centered
on each wavelength layer. Default: 150A.</p></li>
<li><p><strong>wmasks</strong> (<em>list</em>) – List of wavelength tuples to exclude when making
white-light images. Use to exclude nebular emission or sky lines.</p></li>
<li><p><strong>slice_axis</strong> (<em>int</em>) – Which axis represents the slices of the image.
For KCWI default data cubes, slice_axis = 2. For PCWI data cubes,
slice_axis = 1.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>PSF-subtracted data cube
numpy.ndarray: PSF model data</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cwitools.subtraction.psf_sub_2d">
<code class="sig-prename descclassname">cwitools.subtraction.</code><code class="sig-name descname">psf_sub_2d</code><span class="sig-paren">(</span><em class="sig-param">inputfits</em>, <em class="sig-param">pos</em>, <em class="sig-param">fit_rad=1.5</em>, <em class="sig-param">sub_rad=5.0</em>, <em class="sig-param">wl_window=200</em>, <em class="sig-param">wmasks=[]</em>, <em class="sig-param">recenter=True</em>, <em class="sig-param">recenter_rad=5</em><span class="sig-paren">)</span><a class="headerlink" href="#cwitools.subtraction.psf_sub_2d" title="Permalink to this definition">¶</a></dt>
<dd><p>Models and subtracts point-sources in a 3D data cube.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inputfits</strong> (<em>astrop FITS object</em>) – Input data cube/FITS.</p></li>
<li><p><strong>fit_rad</strong> (<em>float</em>) – Inner radius, used for fitting PSF.</p></li>
<li><p><strong>sub_rad</strong> (<em>float</em>) – Outer radius, used to subtract PSF.</p></li>
<li><p><strong>pos</strong> (<em>float tuple</em>) – (x,y) position of the source to subtract.</p></li>
<li><p><strong>recenter</strong> (<em>bool</em>) – Recenter the input (x, y) using the centroid within a
box of size recenter_box, arcseconds.</p></li>
<li><p><strong>recenter_rad</strong> (<em>float</em>) – Radius of circle used to recenter PSF, in arcsec.</p></li>
<li><p><strong>wl_window</strong> (<em>int</em>) – Size of white-light window (in Angstrom) to use.
This is the window used to form a white-light image centered
on each wavelength layer. Default: 200A.</p></li>
<li><p><strong>wmasks</strong> (<em>list</em>) – List of wavelength tuples to exclude when making
white-light images. Use to exclude nebular emission or sky lines.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>PSF-subtracted data cube
numpy.ndarray: PSF model cube</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="cwitools.subtraction.psf_sub_all">
<code class="sig-prename descclassname">cwitools.subtraction.</code><code class="sig-name descname">psf_sub_all</code><span class="sig-paren">(</span><em class="sig-param">inputfits</em>, <em class="sig-param">fit_rad=1.5</em>, <em class="sig-param">sub_rad=5.0</em>, <em class="sig-param">reg=None</em>, <em class="sig-param">pos=None</em>, <em class="sig-param">recenter=True</em>, <em class="sig-param">auto=7</em>, <em class="sig-param">wl_window=200</em>, <em class="sig-param">wmasks=[]</em>, <em class="sig-param">slice_axis=2</em>, <em class="sig-param">method='2d'</em><span class="sig-paren">)</span><a class="headerlink" href="#cwitools.subtraction.psf_sub_all" title="Permalink to this definition">¶</a></dt>
<dd><p>Models and subtracts point-sources in a 3D data cube.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inputfits</strong> (<em>astrop FITS object</em>) – Input data cube/FITS.</p></li>
<li><p><strong>fit_rad</strong> (<em>float</em>) – Inner radius, used for fitting PSF.</p></li>
<li><p><strong>sub_rad</strong> (<em>float</em>) – Outer radius, used to subtract PSF.</p></li>
<li><p><strong>reg</strong> (<em>str</em>) – Path to a DS9 region file containing sources to subtract.</p></li>
<li><p><strong>pos</strong> (<em>float tuple</em>) – (x,y) position of the source to subtract.</p></li>
<li><p><strong>auto</strong> (<em>float</em>) – SNR above which to automatically detect/subtract sources.
Note: One of the parameters reg, pos, or auto must be provided.</p></li>
<li><p><strong>wl_window</strong> (<em>int</em>) – Size of white-light window (in Angstrom) to use.
This is the window used to form a white-light image centered
on each wavelength layer. Default: 200A.</p></li>
<li><p><strong>method</strong> (<em>str</em>) – Method of PSF subtraction.
‘1d’: Subtract PSFs on slice-by-slice basis with 1D models.
‘2d’: Subtract PSFs using a 2D PSF model.</p></li>
<li><p><strong>wmask</strong> (<em>int tuple</em>) – Wavelength region to exclude from white-light images.</p></li>
<li><p><strong>slice_axis</strong> (<em>int</em>) – Which axis represents the slices of the image.
For KCWI default data cubes, slice_axis = 2. For PCWI data cubes,
slice_axis = 1. Only relevant if using 1d subtraction.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>PSF-subtracted data cube
numpy.ndarray: PSF model cube</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>FileNotFoundError</strong> – If region file is not found.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>To subtract point sources from an input cube using a DS9 region file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.io</span> <span class="k">import</span> <span class="n">fits</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">cwitools</span> <span class="k">import</span> <span class="n">psf_subtract</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">myregfile</span> <span class="o">=</span> <span class="s2">&quot;mysources.reg&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">myfits</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;mydata.fits&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sub_cube</span><span class="p">,</span> <span class="n">psf_model</span> <span class="o">=</span> <span class="n">psf_subtract</span><span class="p">(</span><span class="n">myfits</span><span class="p">,</span> <span class="n">reg</span> <span class="o">=</span> <span class="n">myregfile</span><span class="p">)</span>
</pre></div>
</div>
<p>To subtract using automatic source detection with photutils, and a
source S/N ratio &gt;5:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sub_cube</span><span class="p">,</span> <span class="n">psf_model</span> <span class="o">=</span> <span class="n">psf_subtract</span><span class="p">(</span><span class="n">myfits</span><span class="p">,</span> <span class="n">auto</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>Or to subtract a single source from a specific location (x,y)=(21.1,34.6):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sub_cube</span><span class="p">,</span> <span class="n">psf_model</span> <span class="o">=</span> <span class="n">psf_subtract</span><span class="p">(</span><span class="n">myfits</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mf">21.1</span><span class="p">,</span> <span class="mf">34.6</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="module-cwitools.variance">
<span id="cwitools-analysis-variance-module"></span><h2>cwitools.variance module<a class="headerlink" href="#module-cwitools.variance" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="cwitools.variance.estimate_variance">
<code class="sig-prename descclassname">cwitools.variance.</code><code class="sig-name descname">estimate_variance</code><span class="sig-paren">(</span><em class="sig-param">inputfits</em>, <em class="sig-param">zwindow=5</em>, <em class="sig-param">zmask=(0</em>, <em class="sig-param">0)</em>, <em class="sig-param">fmin=0.9</em><span class="sig-paren">)</span><a class="headerlink" href="#cwitools.variance.estimate_variance" title="Permalink to this definition">¶</a></dt>
<dd><p>Estimates the 3D variance cube of an input cube.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inputfits</strong> (<em>astropy.io.fits.HDUList</em>) – FITS object to estimate variance of.</p></li>
<li><p><strong>zWindow</strong> (<em>int</em>) – Size of z-axis bins to use for 2D variance estimation. Default: 10.</p></li>
<li><p><strong>rescale</strong> (<em>bool</em>) – Set to TRUE to perform layer-by-layer rescaling of 2D variance.</p></li>
<li><p><strong>sclip</strong> (<em>float</em>) – Threshold (in stddevs) for sigma-clipping data before estimation.</p></li>
<li><p><strong>zmask</strong> (<em>int tuple</em>) – Wavelength layers to exclude while estimating variance.</p></li>
<li><p><strong>fMin</strong> (<em>float</em>) – The minimum rescaling factor (Default 0.9)</p></li>
<li><p><strong>fileExt</strong> (<em>str</em>) – The extension to use for the output cube (Default .var.fits)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Estimated variance cube</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>NumPy ndarray</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.io</span> <span class="k">import</span> <span class="n">fits</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">cwitools.variance</span> <span class="k">import</span> <span class="n">estimate_variance</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">myfits</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;mydata.fits&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">varcube</span> <span class="o">=</span> <span class="n">estimate_variance</span><span class="p">(</span><span class="n">myfits</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">varfits</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">HDUList</span><span class="p">([</span><span class="n">fits</span><span class="o">.</span><span class="n">primaryHDU</span><span class="p">(</span><span class="n">varcube</span><span class="p">)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">varfits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">myfits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">varfits</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="s2">&quot;mydata_var.fits&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="cwitools.variance.rescale_var">
<code class="sig-prename descclassname">cwitools.variance.</code><code class="sig-name descname">rescale_var</code><span class="sig-paren">(</span><em class="sig-param">varcube</em>, <em class="sig-param">datacube</em>, <em class="sig-param">fmin=0.9</em><span class="sig-paren">)</span><a class="headerlink" href="#cwitools.variance.rescale_var" title="Permalink to this definition">¶</a></dt>
<dd><p>Rescale a variance cube layer-by-layer to reflect the noise of a data cube.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>varcube</strong> (<em>NumPy.ndarray</em>) – Variance cube to rescale.</p></li>
<li><p><strong>datacube</strong> (<em>NumPy.ndarray</em>) – Data cube corresponding to variance cube.</p></li>
<li><p><strong>fmin</strong> (<em>float</em>) – Minimum rescaling factor (Default=0.9)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Rescaled variance cube</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>NumPy ndarray</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.io</span> <span class="k">import</span> <span class="n">fits</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">cwitools.variance</span> <span class="k">import</span> <span class="n">rescale_variance</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;data.fits&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">var</span>  <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s2">&quot;variance.fits&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">var_rescaled</span> <span class="o">=</span> <span class="n">rescale_variance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">CWITools</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Donal O'Sullivan.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/cwitools.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>